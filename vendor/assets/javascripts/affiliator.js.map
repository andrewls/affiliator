{"version":3,"sources":["../../../src/affiliator.es6"],"names":["AmazonTransformer","tag","base","suffix","link","asin","matches","match","NoopTransformer","transformers","AffiliateManager","affiliates","noop","affiliateName","affiliateInformation","affiliate","getAffiliateForLink","transform"],"mappings":";;;;;;;;;;IAAMA,iB;AACL,4BAAYC,GAAZ,EAAiB;AAAA;;AAChB,OAAKC,IAAL,GAAY,8BAAZ;AACA,OAAKC,MAAL,aAAsBF,GAAtB;AACA;;;;4BAESG,I,EAAM;AACf,OAAI,KAAKD,MAAL,KAAgB,gBAApB,EAAsC,OAAOC,IAAP;AACtC,OAAIC,OAAO,KAAKA,IAAL,CAAUD,IAAV,CAAX;AACA,OAAIC,IAAJ,EAAU,YAAU,KAAKH,IAAf,GAAsB,KAAKG,IAAL,CAAUD,IAAV,CAAtB,GAAwC,KAAKD,MAA7C,CAAV,KACK,OAAOC,IAAP;AACL;;;uBAEIA,I,EAAM;AACV,OAAIE,UAAUF,KAAKG,KAAL,CAAW,uBAAX,CAAd;AACA,OAAID,OAAJ,EAAa;AACZ,WAAOA,QAAQ,CAAR,EAAWC,KAAX,CAAiB,kBAAjB,EAAqC,CAArC,CAAP;AACA,IAFD,MAGK;AACJ,WAAO,IAAP;AACA;AACD;;;;;;IAGIC,e;;;;;;;4BACKJ,I,EAAM;AACf,UAAOA,IAAP;AACA;;;;;;AAGF,IAAIK,eAAe;AAClB,WAAUT;AADQ,CAAnB;;IAIMU,gB;AACL,6BAAc;AAAA;;AACb,OAAKC,UAAL,GAAkB;AACjBC,SAAM,IAAIJ,eAAJ;AADW,GAAlB;AAGA;;;;+BAEYK,a,EAAwC;AAAA,qCAAtBC,oBAAsB;AAAtBA,wBAAsB;AAAA;;AACpD,QAAKH,UAAL,CAAgBE,aAAhB,uCAAqCJ,aAAaI,aAAb,CAArC,gBAAoEC,oBAApE;AACA;;;sCAEmBV,I,EAAM;AACzB,OAAIA,KAAKG,KAAL,CAAW,kBAAX,KAAkC,KAAKI,UAAL,CAAgB,QAAhB,CAAtC,EAAiE,OAAO,QAAP,CAAjE,KACK,OAAO,MAAP;AACL;;;gCAEaP,I,EAAM;AACnB,OAAIW,YAAY,KAAKC,mBAAL,CAAyBZ,IAAzB,CAAhB;AACA,UAAO,KAAKO,UAAL,CAAgB,KAAKK,mBAAL,CAAyBZ,IAAzB,CAAhB,EAAgDa,SAAhD,CAA0Db,IAA1D,CAAP;AACA;;;;;;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;QAESJ,iB,GAAAA,iB;QACAQ,e,GAAAA,e;kBACME,gB","file":"affiliator.js","sourcesContent":["class AmazonTransformer {\n\tconstructor(tag) {\n\t\tthis.base = \"https://smile.amazon.com/dp/\"\n\t\tthis.suffix = `?tag=${tag}`\n\t}\n\n\ttransform(link) {\n\t\tif (this.suffix === '?tag=undefined') return link\n\t\tlet asin = this.asin(link)\n\t\tif (asin) return `${this.base}${this.asin(link)}${this.suffix}`\n\t\telse return link\n\t}\n\n\tasin(link) {\n\t\tlet matches = link.match(/\\/[A-Za-z0-9]{10}\\/?/g)\n\t\tif (matches) {\n\t\t\treturn matches[0].match(/[A-Za-z0-9]{10}/g)[0]\n\t\t}\n\t\telse {\n\t\t\treturn null\n\t\t}\n\t}\n}\n\nclass NoopTransformer {\n\ttransform(link) {\n\t\treturn link\n\t}\n}\n\nlet transformers = {\n\t'amazon': AmazonTransformer\n}\n\nclass AffiliateManager {\n\tconstructor() {\n\t\tthis.affiliates = {\n\t\t\tnoop: new NoopTransformer()\n\t\t}\n\t}\n\n\taddAffiliate(affiliateName, ...affiliateInformation) {\n\t\tthis.affiliates[affiliateName] = new transformers[affiliateName](...affiliateInformation)\n\t}\n\n\tgetAffiliateForLink(link) {\n\t\tif (link.match(/^.*amazon.com.*/g) && this.affiliates['amazon']) return 'amazon'\n\t\telse return 'noop'\n\t}\n\n\ttransformLink(link) {\n\t\tlet affiliate = this.getAffiliateForLink(link)\n\t\treturn this.affiliates[this.getAffiliateForLink(link)].transform(link)\n\t}\n}\n\n// Jquery plugin\n// if (jQuery) {\n// \t(function( $ ) {\n// \t    $.fn.affiliate = function(affiliateManager) {\n// \t    \tconsole.log(\"Calling affiliate\")\n// \t        this.filter(\"a\").each(function() {\n// \t            let link = $(this)\n// \t            link.attr('href', affiliateManager.transformLink(link.attr('href')))\n// \t        })\n// \t        return this\n// \t    }\n// \t}(jQuery))\t\n// }\n\nexport { AmazonTransformer };\nexport { NoopTransformer };\nexport default AffiliateManager;\n"]}